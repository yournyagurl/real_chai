import discord
from discord.ext import commands
from discord.ui import Button, View
from PIL import Image, ImageDraw, ImageFont
import random
import io
import math
import imageio

intents = discord.Intents.default()
intents.guilds = True
intents.messages = True
intents.voice_states = True
intents.message_content = True
intents.members = True

bot = commands.Bot(command_prefix="!", intents=intents)

@bot.event
async def on_ready():
    print(f'Logged in as {bot.user}')

class SpinButton(Button):
    def __init__(self):
        super().__init__(label='Spin the Wheel', style=discord.ButtonStyle.primary)

    async def callback(self, interaction: discord.Interaction):
        options = ['Option 1', 'Option 2', 'Option 3', 'Option 4']
        result = random.choice(options)
        
        # Create the wheel frames for animation
        size = 500
        num_frames = 60
        slowdown_factor = 1.05  # Increase to slow down more rapidly
        angle_increment = 10
        current_angle = 0
        frames = []
        
        for frame in range(num_frames):
            wheel = Image.new('RGBA', (size, size), (0, 0, 0, 0))
            draw = ImageDraw.Draw(wheel)
            font = ImageFont.truetype("arial.ttf", 20)
            
            num_segments = len(options)
            segment_angle = 360 / num_segments
            for i, option in enumerate(options):
                start_angle = (i * segment_angle + current_angle) % 360
                end_angle = (start_angle + segment_angle) % 360
                draw.pieslice([0, 0, size, size], start_angle, end_angle, fill=(random.randint(0, 255), random.randint(0, 255), random.randint(0, 255)))
                text_angle = start_angle + (segment_angle / 2)
                x = size / 2 + (size / 3) * math.cos(math.radians(text_angle))
                y = size / 2 + (size / 3) * math.sin(math.radians(text_angle))
                draw.text((x, y), option, font=font, fill=(0, 0, 0))
            
            buffer = io.BytesIO()
            wheel.save(buffer, format='PNG')
            buffer.seek(0)
            frame_image = Image.open(buffer)
            frames.append(frame_image)
            
            # Increment the angle and reduce the increment to slow down
            current_angle += angle_increment
            angle_increment /= slowdown_factor

        # Save frames as a GIF
        gif_buffer = io.BytesIO()
        frames[0].save(gif_buffer, format='GIF', save_all=True, append_images=frames[1:], duration=50, loop=0)
        gif_buffer.seek(0)

        # Send the GIF to Discord
        file = discord.File(fp=gif_buffer, filename='wheel.gif')
        await interaction.response.send_message(f'The wheel landed on: {result}', file=file)

@bot.command(name='spin')
async def spin(ctx):
    button = SpinButton()
    view = View()
    view.add_item(button)
    await ctx.send('Click the button to spin the wheel!', view=view)


bot.run('MTI0MTc0NTU5ODg2NDk1MzM0NA.GLA-hF.GmiGVIDzpkicuSuCaY0XCaH8yNhosaVz4LoedA')
